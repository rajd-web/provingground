<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Weather & Proving Ground – Skellefteå</title>

<style>
:root{
  --pad:24px;
  --card:rgba(0,0,0,.62);
  --radius:16px;
  --leftW:60vw;
  --rightW:40vw;
}

html,body{
  height:100%;
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  color:#fff;
}

/* MAP */
#map{
  position:fixed;
  left:0; top:0;
  width:var(--leftW);
  height:100vh;
  border:0;
}

/* TOP TITLE */
#pageTitle{
  position:fixed;
  top:var(--pad);
  left:var(--pad);
  background:var(--card);
  padding:14px 28px;
  border-radius:18px;
  font-size:38px;
  font-weight:800;
  z-index:30;
  backdrop-filter:blur(6px);
}

/* WEATHER HUD */
#hud{
  position:fixed;
  top:96px;
  left:var(--pad);
  width:min(720px, calc(var(--leftW) - (var(--pad)*2)));
  background:var(--card);
  padding:18px 22px;
  border-radius:var(--radius);
  backdrop-filter:blur(6px);
}

#rowTop{
  display:flex;
  justify-content:space-between;
}
#place{font-size:30px;margin:0;}
#time{font-size:34px;font-weight:700;}
#date{font-size:18px;opacity:.9;}

#nowRow{
  display:flex;
  align-items:center;
  gap:18px;
  margin-top:14px;
}
#nowIcon svg{width:90px;height:90px;}
#nowTemp{font-size:104px;font-weight:800;}

#desc{font-size:22px;margin-top:6px;}
#updated{font-size:16px;opacity:.8;margin-top:4px;}

/* FORECAST BOXES */
#widgets{
  display:flex;
  gap:16px;
  margin-top:16px;
}
.box{
  background:rgba(255,255,255,.12);
  border-radius:14px;
  padding:16px;
  flex:1;
}
.label{font-size:18px;font-weight:700;}
.row{
  display:flex;
  align-items:center;
  gap:12px;
}
.row svg{width:56px;height:56px;}
.temp{font-size:38px;font-weight:800;}
.text{font-size:16px;opacity:.9;margin-top:6px;}

/* RIGHT PANE */
#rightPane{
  position:fixed;
  right:0; top:0;
  width:var(--rightW);
  height:100vh;
  padding:var(--pad);
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  backdrop-filter:blur(6px);
}

#trackHeader{
  font-size:26px;
  font-weight:800;
  margin-bottom:12px;
}

/* Placeholder card content (test A) */
#trackFrameWrap{
  position:relative;
  height:calc(100vh - 180px);
  overflow:hidden;
  border-radius: var(--radius);
}

#trackPlaceholder{
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:14px;
  padding:18px;
}

#trackMsgTitle{
  font-size:24px;
  font-weight:900;
}

#trackMsgText{
  font-size:16px;
  opacity:.9;
  line-height:1.35;
}

#trackBigButton{
  display:block;
  text-align:center;
  padding:18px 16px;
  border-radius:14px;
  background: rgba(255,255,255,.14);
  color:#fff;
  font-size:22px;
  font-weight:900;
  text-decoration:none;
}

#fallback{
  font-size:14px;
  opacity:.85;
  margin-top:10px;
}
#fallback a{color:#fff;}
</style>
</head>

<body>

<!-- MAP (your chosen OSM zoom/bbox) -->
<iframe id="map"
  src="https://www.openstreetmap.org/export/embed.html?bbox=20.956485271453857,64.73460494231747,20.978586673736576,64.73987965842787&layer=mapnik&marker=64.73724,20.96754">
</iframe>

<!-- TITLE -->
<div id="pageTitle">Weather forecast</div>

<!-- WEATHER -->
<section id="hud">
  <div id="rowTop">
    <h1 id="place">Skellefteå</h1>
    <div>
      <div id="time">--:--</div>
      <div id="date">----</div>
    </div>
  </div>

  <div id="nowRow">
    <div id="nowIcon"></div>
    <div id="nowTemp">--°C</div>
  </div>

  <div id="desc">Loading weather…</div>
  <div id="updated"></div>

  <div id="widgets">
    <div class="box">
      <div class="label">Now</div>
      <div class="row">
        <div id="iNow"></div>
        <div id="tNow" class="temp"></div>
      </div>
      <div id="dNow" class="text"></div>
    </div>

    <div class="box">
      <div class="label">In 3 hours</div>
      <div class="row">
        <div id="i3"></div>
        <div id="t3" class="temp"></div>
      </div>
      <div id="d3" class="text"></div>
    </div>

    <div class="box">
      <div class="label">Tomorrow</div>
      <div class="row">
        <div id="iT"></div>
        <div id="tT" class="temp"></div>
      </div>
      <div id="dT" class="text"></div>
    </div>
  </div>
</section>

<!-- TRACK STATUS (test A: button) -->
<aside id="rightPane">
  <div class="card">
    <div id="trackHeader">Proving Ground status</div>

    <div id="trackFrameWrap">
      <div id="trackPlaceholder">
        <div id="trackMsgTitle">Open status</div>
        <div id="trackMsgText">
          The status page requires login and can’t be embedded reliably in this dashboard view.
          Open it in a new tab.
        </div>

        <a id="trackBigButton" href="#" target="_blank" rel="noopener">
          Open Proving Ground status
        </a>
      </div>
    </div>

    <div id="fallback">
      Direct link:
      <a id="trackLink" target="_blank" rel="noopener">Open Proving Ground status</a>
    </div>
  </div>
</aside>

<script>
/* SETTINGS
   Weather position is the same as your OpenStreetMap marker/zoom center. */
const LAT = 64.73724, LON = 20.96754;

const TRACK_URL =
  "https://test01.rajdsystech.com/resources?id=20,21,22,23,24,25,26,27&title=Proving%20Ground";

const SMHI_URL =
  `https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${LON}/lat/${LAT}/data.json`;

/* INIT TRACK LINKS */
document.getElementById("trackBigButton").href = TRACK_URL;
document.getElementById("trackLink").href = TRACK_URL;

/* CLOCK */
function clock(){
  const n=new Date();
  document.getElementById("time").textContent =
    n.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("date").textContent =
    n.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
}

/* Simple placeholder icon (kept from your version) */
function icon(){
  return `<svg viewBox="0 0 64 64" fill="white" xmlns="http://www.w3.org/2000/svg">
    <circle cx="32" cy="32" r="14"/>
  </svg>`;
}

/* WEATHER (SMHI) */
function pVal(tsItem, name){
  const p = tsItem.parameters.find(x => x.name === name);
  return p ? p.values[0] : null;
}

async function load(){
  try{
    const d = await fetch(SMHI_URL, { cache: "no-store" }).then(r=>r.json());
    const ts = d.timeSeries;
    if(!ts || !ts.length) throw new Error("No timeseries");

    // Use first forecast step as "now"
    const cur = ts[0];
    const t = pVal(cur, "t");

    document.getElementById("nowIcon").innerHTML = icon();
    document.getElementById("nowTemp").textContent = (t!=null) ? (Math.round(t)+"°C") : "--°C";
    document.getElementById("desc").textContent = "SMHI forecast";
    document.getElementById("updated").textContent =
      "Updated: " + new Date(cur.validTime).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});

    document.getElementById("iNow").innerHTML = icon();
    document.getElementById("tNow").textContent = (t!=null) ? (Math.round(t)+"°C") : "--°C";
    document.getElementById("dNow").textContent = "Now";

    // "In 3 hours": 3 steps ahead (works fine for early hourly steps)
    const t3 = pVal(ts[Math.min(3, ts.length-1)], "t");
    document.getElementById("i3").innerHTML = icon();
    document.getElementById("t3").textContent = (t3!=null) ? (Math.round(t3)+"°C") : "--°C";
    document.getElementById("d3").textContent = "In 3 hours";

    // "Tomorrow": pick ~24 steps ahead if available (simple approach)
    const idxT = Math.min(24, ts.length-1);
    const tT = pVal(ts[idxT], "t");
    document.getElementById("iT").innerHTML = icon();
    document.getElementById("tT").textContent = (tT!=null) ? (Math.round(tT)+"°C") : "--°C";
    document.getElementById("dT").textContent = "Tomorrow";
  } catch(e){
    document.getElementById("desc").textContent = "Weather data unavailable (SMHI)";
    document.getElementById("updated").textContent = "";
  }
}

clock(); setInterval(clock,1000);
load();  setInterval(load,600000);
</script>

</body>
</html>

